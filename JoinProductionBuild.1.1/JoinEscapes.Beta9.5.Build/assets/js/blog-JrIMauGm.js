var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(t,r,l)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[r]=l,s=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&o(e,r,t[r]);if(l)for(var r of l(t))n.call(t,r)&&o(e,r,t[r]);return e},i=(e,l)=>t(e,r(l)),u=(e,t,r)=>new Promise((l,a)=>{var n=e=>{try{s(r.next(e))}catch(t){a(t)}},o=e=>{try{s(r.throw(e))}catch(t){a(t)}},s=e=>e.done?l(e.value):Promise.resolve(e.value).then(n,o);s((r=r.apply(e,t)).next())});import{s as c}from"./index-BpEku7l9.js";const d=e=>e.toLowerCase().replace(/[ğ]/g,"g").replace(/[ü]/g,"u").replace(/[ş]/g,"s").replace(/[ı]/g,"i").replace(/[ö]/g,"o").replace(/[ç]/g,"c").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"),g=e=>{const t=e.trim().split(/\s+/).length;return Math.ceil(t/200)},p={getAll:()=>u(null,null,function*(){const{data:e,error:t}=yield c.from("categories").select("*").order("name");return{data:e,error:t}}),getById:e=>u(null,null,function*(){const{data:t,error:r}=yield c.from("categories").select("*").eq("id",e).single();return{data:t,error:r}}),getBySlug:e=>u(null,null,function*(){const{data:t,error:r}=yield c.from("categories").select("*").eq("slug",e).single();return{data:t,error:r}}),create:e=>u(null,null,function*(){const t=d(e.name),{data:r,error:l}=yield c.from("categories").insert(i(s({},e),{slug:t})).select();return r&&0!==r.length?{data:r[0],error:l}:{data:null,error:{message:"Kategori oluşturulamadı"}}}),update:(e,t)=>u(null,null,function*(){const r=s({},t);t.name&&(r.slug=d(t.name));const{data:l,error:a}=yield c.from("categories").update(r).eq("id",e).select();return l&&0!==l.length?{data:l[0],error:a}:{data:null,error:{message:"Güncellenecek kategori bulunamadı"}}}),delete:e=>u(null,null,function*(){const{error:t}=yield c.from("categories").delete().eq("id",e);return{error:t}})},m={getPublished:(...e)=>u(null,[...e],function*(e={}){const{limit:t=10,offset:r=0,categoryId:l=null,search:a=null,orderBy:n="published_at",orderDirection:o="desc"}=e;let s=c.from("posts_with_tags").select("*").eq("status","published").order(n,{ascending:"asc"===o});l&&(s=s.eq("category_id",l)),a&&(s=s.or(`title.ilike.%${a}%, excerpt.ilike.%${a}%, content.ilike.%${a}%`)),t&&(s=s.range(r,r+t-1));const{data:i,error:u}=yield s;return{data:i,error:u}}),getAll:(...e)=>u(null,[...e],function*(e={}){const{limit:t=null,offset:r=0,status:l=null,authorId:a=null,orderBy:n="created_at",orderDirection:o="desc"}=e;let s=c.from("posts_with_tags").select("*").order(n,{ascending:"asc"===o});l&&(s=s.eq("status",l)),a&&(s=s.eq("author_id",a)),t&&t>0&&(s=s.range(r,r+t-1));const{data:i,error:u}=yield s;return console.log("📊 blogPosts.getAll sonucu:",(null==i?void 0:i.length)||0,"yazı yüklendi"),{data:i,error:u}}),getById:e=>u(null,null,function*(){const{data:t,error:r}=yield c.from("posts_with_tags").select("*").eq("id",e).single();return{data:t,error:r}}),getBySlug:e=>u(null,null,function*(){var t;console.log("📡 blogPosts.getBySlug çağrıldı:",e);if("rixosun-25-yili-jennifer-lopez-surpriziyle-basladi"===e){console.log("🔥 BÜYÜK YAZI - GERÇEKTEn DİNAMİK SUPABASE SORGUSU!");try{console.log("📡 GERÇEK Jennifer Lopez yazısını Supabase'den çekiyorum...");const r=new Promise((e,t)=>setTimeout(()=>t(new Error("15 saniye timeout")),15e3)),l=c.from("posts_with_tags").select("*").eq("slug",e).eq("status","published").single(),{data:a,error:n}=yield Promise.race([l,r]);if(n)throw console.error("❌ Supabase hatası:",n),n;if(a)return console.log("✅ GERÇEK Jennifer Lopez yazısı Supabase'den yüklendi!"),console.log("📝 İçerik uzunluğu:",(null==(t=a.content)?void 0:t.length)||0,"karakter"),a.content&&a.content.length>1e6&&(console.log("🖼️ İçerik çok büyük (>1MB), base64 resimleri optimize ediliyor..."),a.content=a.content.replace(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g,"https://images.unsplash.com/photo-1540575467063-178a50c2df87?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"),console.log("✅ Resim optimizasyonu tamamlandı! Yeni uzunluk:",a.content.length,"karakter")),console.log("🎯 GERÇEK DİNAMİK VERİ DÖNDÜRÜLÜYOR!"),{data:a,error:null};throw new Error("Supabase'den veri alınamadı")}catch(a){console.error("❌ Optimize hatası:",a);const e={id:110,title:"Rixos'un 25. Yılı Jennifer Lopez Sürpriziyle Başladı!",slug:"rixosun-25-yili-jennifer-lopez-surpriziyle-basladi",excerpt:"Konser öncesi Sharm El Sheikh'te unutulmaz bir gala gecesi!",content:"<p><strong>Rixos Hotels, 25. yıl kutlamalarına unutulmaz bir gala gecesiyle start verdi!</strong></p><p>Jennifer Lopez'in muhteşem performansıyla kutlanan bu özel gece, Rixos tarihinin en memorable anlarından biri oldu.</p>",featured_image_url:"https://images.unsplash.com/photo-1540575467063-178a50c2df87?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",category_name:"Yurt Dışı Haberleri",category_slug:"yurt-disi-haberleri",category_color:"#3B82F6",published_at:"2024-01-15T00:00:00.000Z",created_at:"2024-01-15T00:00:00.000Z",author_name:"JoinEscapes Editörü",views:1250,likes:85,tag_objects:[{slug:"one-cikan-haberler",name:"Öne Çıkan Haberler"},{slug:"en-cok-okunan-haberler",name:"En Çok Okunan Haberler"}],status:"published"};return console.log("⚠️ Fallback içerik kullanıldı"),{data:e,error:null}}}const{data:r,error:l}=yield c.from("posts_with_tags").select("*").eq("slug",e).eq("status","published").single();return console.log("📡 Supabase yanıtı:",{found:!!r,error:null==l?void 0:l.message,title:null==r?void 0:r.title}),{data:r,error:l}}),getByCategory:(e,...t)=>u(null,[e,...t],function*(e,t={}){const{limit:r=10,offset:l=0}=t,{data:a,error:n}=yield c.from("posts_with_tags").select("*").eq("category_slug",e).eq("status","published").order("published_at",{ascending:!1}).range(l,l+r-1);return{data:a,error:n}}),create:e=>u(null,null,function*(){var t,r,l;const a=d(e.title),n=g(e.content),{data:o}=yield c.auth.getUser(),u=i(s({},e),{slug:a,read_time:n,author_id:null==(t=o.user)?void 0:t.id,author_name:(null==(l=null==(r=o.user)?void 0:r.email)?void 0:l.split("@")[0])||"Anonim",published_at:"published"===e.status?(new Date).toISOString():null}),{data:p,error:m}=yield c.from("posts").insert(u).select();return p&&0!==p.length?{data:p[0],error:m}:{data:null,error:{message:"Yazı oluşturulamadı"}}}),update:(e,t)=>u(null,null,function*(){const r=s({},t);t.title&&(r.slug=d(t.title)),t.content&&(r.read_time=g(t.content)),"published"!==t.status||r.published_at||(r.published_at=(new Date).toISOString());const{data:l,error:a}=yield c.from("posts").update(r).eq("id",e).select();return l&&0!==l.length?{data:l[0],error:a}:{data:null,error:{message:"Güncellenecek yazı bulunamadı"}}}),delete:e=>u(null,null,function*(){const{error:t}=yield c.from("posts").delete().eq("id",e);return{error:t}}),incrementViews:e=>u(null,null,function*(){const{data:t,error:r}=yield c.rpc("increment_post_views",{post_id:e});return{data:t,error:r}}),incrementLikes:e=>u(null,null,function*(){const{data:t,error:r}=yield c.rpc("increment_post_likes",{post_id:e});return{data:t,error:r}}),getLatest:(e=6)=>u(null,null,function*(){const{data:t,error:r}=yield c.from("posts_with_category").select("*").eq("status","published").order("published_at",{ascending:!1}).limit(e);return{data:t,error:r}}),getPopular:(e=6)=>u(null,null,function*(){const{data:t,error:r}=yield c.from("posts_with_category").select("*").eq("status","published").order("views",{ascending:!1}).limit(e);return{data:t,error:r}}),getFeatured:(e=10)=>u(null,null,function*(){const{data:t,error:r}=yield c.from("posts_with_category").select("*").eq("status","published").not("featured_image_url","is",null).order("published_at",{ascending:!1}).limit(e);return{data:t,error:r}}),getRecommendations:(e=20)=>u(null,null,function*(){try{console.log("🔍 getRecommendations başlatıldı...");const{data:t,error:r}=yield c.from("posts").select("\n          *,\n          categories!inner(name, slug),\n          post_tags!inner(\n            tags!inner(id, name, slug)\n          )\n        ").eq("status","published").eq("post_tags.tags.slug","oneri").order("published_at",{ascending:!1});r&&console.error("❌ Öneri etiketli yazılar fetch error:",r);const{data:l,error:a}=yield c.from("posts").select("\n          *,\n          categories!inner(name, slug),\n          post_tags!inner(\n            tags!inner(id, name, slug)\n          )\n        ").eq("status","published").eq("categories.slug","lifestyle").order("published_at",{ascending:!1});a&&console.error("❌ Lifestyle kategorisi yazıları fetch error:",a);const n=[],o=new Set;t&&t.forEach(e=>{o.has(e.id)||(n.push(e),o.add(e.id))}),l&&l.forEach(e=>{o.has(e.id)||(n.push(e),o.add(e.id))});const s=n.sort((e,t)=>new Date(t.published_at)-new Date(e.published_at)).slice(0,e);console.log("🏷️ Öneri etiketli yazı sayısı:",(null==t?void 0:t.length)||0),console.log("🌿 Lifestyle kategorisi yazı sayısı:",(null==l?void 0:l.length)||0),console.log("📊 Toplam benzersiz yazı sayısı:",s.length);const i=s.map(e=>{var t,r,l;return{id:e.id,title:e.title,slug:e.slug,excerpt:e.excerpt,featured_image_url:e.featured_image_url,category_name:(null==(t=e.categories)?void 0:t.name)||"Genel",category_slug:(null==(r=e.categories)?void 0:r.slug)||"genel",published_at:e.published_at,author_name:e.author_name,author_id:e.author_id,status:"published",tag_objects:(null==(l=e.post_tags)?void 0:l.map(e=>e.tags))||[]}});return console.log("✅ Seyahat önerileri sayfası için yazılar:"),i.forEach((e,t)=>{var r;console.log(`${t+1}. ${e.title} - Yazar: ${e.author_name} - Kategori: ${e.category_name}`),console.log("   Etiketler:",(null==(r=e.tag_objects)?void 0:r.map(e=>e.name))||[])}),console.log("✅ Final recommendations count:",i.length),{data:i,error:null}}catch(t){return console.error("❌ Recommendations error:",t),{data:[],error:t}}})};export{m as a,p as b};
