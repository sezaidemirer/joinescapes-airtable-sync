var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,i=(l,a,s)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[a]=s,o=(e,l)=>{for(var a in l||(l={}))r.call(l,a)&&i(e,a,l[a]);if(s)for(var a of s(l))t.call(l,a)&&i(e,a,l[a]);return e},n=(e,s)=>l(e,a(s)),d=(e,l,a)=>new Promise((s,r)=>{var t=e=>{try{o(a.next(e))}catch(l){r(l)}},i=e=>{try{o(a.throw(e))}catch(l){r(l)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(t,i);o((a=a.apply(e,l)).next())});import{u as c,s as m,j as u}from"./index-DcAdAIex.js";import{u as p,d as x,r as g}from"./react-vendor-D69WjZO_.js";import{a as y,b as f}from"./blog-n2C_7SGz.js";import{b as h}from"./tags-DSiyKfHE.js";import b from"./PostForm-BrhPv5YJ.js";import{o as v,m as j,s as N,l as w,y as k,X as _,p as z}from"./ui-vendor-CQDp9-dR.js";import"./supabase-C6BlnBHX.js";import"./utils-CHphCHSg.js";const S=()=>{var e,l,a,s,r,t,i,S,P,M,Y,C,E,U,A,O;const I=p(),{user:D,isAuthenticated:T,loading:$,signOut:K,getCurrentUser:q}=c(),{slug:B}=x(),[G,W]=g.useState("posts"),[H,R]=g.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[L,F]=g.useState(!1),[J,Q]=g.useState(""),[V,X]=g.useState(""),[Z,ee]=g.useState([]),[le,ae]=g.useState([]),[se,re]=g.useState([]),[te,ie]=g.useState(!1),[oe,ne]=g.useState(null),[de,ce]=g.useState(!1),[me,ue]=g.useState({fullName:"",email:"",authorName:"",bio:""}),[pe,xe]=g.useState(!1),[ge,ye]=g.useState(""),[fe,he]=g.useState(""),be=g.useCallback(e=>{var l,a,s,r;if(!e)return"";const t=(null==(l=e.user_metadata)?void 0:l.full_name)||(null==(a=e.email)?void 0:a.split("@")[0])||"kullanici";console.log("🔍 Slug oluşturuluyor:",{user_email:e.email,user_metadata:e.user_metadata,full_name:null==(s=e.user_metadata)?void 0:s.full_name,email_name:null==(r=e.email)?void 0:r.split("@")[0],final_fullName:t});const i=t.toLowerCase().replace(/ğ/g,"g").replace(/ü/g,"u").replace(/ş/g,"s").replace(/ı/g,"i").replace(/ö/g,"o").replace(/ç/g,"c").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-");return console.log("✅ Oluşturulan slug:",i),i},[]);g.useEffect(()=>{var e,l,a,s,r,t;if(!$){if(console.log("🔍 Auth check başlıyor:",{loading:$,isAuthenticated:T,user_email:null==D?void 0:D.email,user_id:null==D?void 0:D.id,user_role:null==(e=null==D?void 0:D.user_metadata)?void 0:e.user_role,editor_approved:null==(l=null==D?void 0:D.user_metadata)?void 0:l.editor_approved,current_slug:B}),!T&&!$)return console.log("🚪 Kullanıcı giriş yapmamış, ana sayfaya yönlendiriliyor"),void I("/");if(T&&D&&D.id){const e=null==(a=null==D?void 0:D.user_metadata)?void 0:a.user_role;if(console.log("👤 Kullanıcı kontrolü:",{email:D.email,role:e,approved:null==(s=D.user_metadata)?void 0:s.editor_approved}),"test@test.com"===D.email)return console.log("🔑 Admin kullanıcı, admin paneline yönlendiriliyor"),void I("/admin");if("editor"!==e&&"yazar"!==e||!(null==(r=D.user_metadata)?void 0:r.editor_approved))return console.log("❌ Yetkisiz kullanıcı veya onaylanmamış editör:",{role:e,approved:null==(t=D.user_metadata)?void 0:t.editor_approved}),void I("/");if(console.log("✅ Kullanıcı yetkili, slug kontrolü yapılıyor..."),!B){const e=be(D);return console.log("🔄 Slug yok, kullanıcı slug'ı ile yönlendiriliyor:",`/yazar/profil/${e}`),void I(`/yazar/profil/${e}`,{replace:!0})}{const e=be(D);if(console.log("🔍 Slug karşılaştırması:",{current_slug:B,user_slug:e,match:B===e}),B!==e)return console.log("🔄 Yanlış slug, doğru URL'ye yönlendiriliyor:",`/yazar/profil/${e}`),void I(`/yazar/profil/${e}`,{replace:!0})}}}},[$,T,D,I,B,be]),g.useEffect(()=>{T&&D&&(d(null,null,function*(){try{console.log("🎨 Editör paneli yükleniyor...");const[e,l,a]=yield Promise.allSettled([Ye(),Ce(),Ee()]);console.log("✅ Editör verileri yüklendi:",{posts:e.status,categories:l.status,tags:a.status})}catch(e){console.error("❌ Editör init hatası:",e)}}),Ue())},[T,null==D?void 0:D.id]);const[ve,je]=g.useState({firstName:"",lastName:"",title:"",bio:"",location:"",specialties:[],socialMedia:{instagram:"",twitter:"",blog:""},profileImage:""}),[Ne,we]=g.useState(""),[ke,_e]=g.useState(!1),[ze,Se]=g.useState(!1),[Pe,Me]=g.useState([]),Ye=()=>d(null,null,function*(){ie(!0);try{const{data:e,error:l}=yield y.getAll({authorId:null==D?void 0:D.id,orderBy:"created_at",orderDirection:"desc"});!l&&e?(ee(e),Me(e),console.log("✅ Editör yazıları yüklendi:",e.length,"yazı")):console.error("❌ Yazılar yüklenemedi:",l)}catch(e){console.error("❌ Yazı fetch hatası:",e)}finally{ie(!1)}}),Ce=()=>d(null,null,function*(){const{data:e,error:l}=yield f.getAll();!l&&e&&ae(e)}),Ee=()=>d(null,null,function*(){const{data:e,error:l}=yield h.getAll();!l&&e&&re(e)}),Ue=()=>d(null,null,function*(){var e,l,a,s,r,t,i,o,n,d,c,u;try{console.log("🔍 Editör profil verisi yükleniyor..."),console.log("👤 Kullanıcı bilgileri:",{email:null==D?void 0:D.email,user_id:null==D?void 0:D.id,user_metadata:null==D?void 0:D.user_metadata});const{data:c,error:u}=yield m.from("writer_profiles").select("*").eq("user_id",null==D?void 0:D.id).single(),p=(null==(e=null==D?void 0:D.user_metadata)?void 0:e.first_name)||"",x=(null==(l=null==D?void 0:D.user_metadata)?void 0:l.last_name)||"";if(console.log("🔍 DEBUG - User metadata'dan çekilen:",{firstName:p,lastName:x,full_name:null==(a=null==D?void 0:D.user_metadata)?void 0:a.full_name}),c&&!u){console.log("✅ Writer_profiles tablosundan veri alındı");const e={firstName:p,lastName:x,title:c.title||"",bio:c.bio||"",location:c.location||"",specialties:c.specialties||[],socialMedia:c.social_media||{instagram:"",twitter:"",blog:""},profileImage:c.profile_image||""};console.log("✅ Profil writer_profiles tablosundan yüklendi!",e),je(e),we(c.profile_image||"")}else{console.log("⚠️ Writer_profiles tablosunda veri yok, user_metadata kullanılıyor");const e={firstName:p,lastName:x,title:(null==(s=null==D?void 0:D.user_metadata)?void 0:s.author_title)||"",bio:(null==(r=null==D?void 0:D.user_metadata)?void 0:r.bio)||"",location:(null==(t=null==D?void 0:D.user_metadata)?void 0:t.location)||"",specialties:(null==(i=null==D?void 0:D.user_metadata)?void 0:i.specialties)||[],socialMedia:(null==(o=null==D?void 0:D.user_metadata)?void 0:o.social_media)||{instagram:"",twitter:"",blog:""},profileImage:(null==(n=null==D?void 0:D.user_metadata)?void 0:n.profile_image)||""};console.log("✅ Profil user_metadata'dan yüklendi!",e),je(e),we((null==(d=null==D?void 0:D.user_metadata)?void 0:d.profile_image)||"")}}catch(p){console.error("❌ Yazar profili yüklenemedi:",p);const e={firstName:(null==(c=null==D?void 0:D.user_metadata)?void 0:c.first_name)||"",lastName:(null==(u=null==D?void 0:D.user_metadata)?void 0:u.last_name)||"",title:"",bio:"",location:"",specialties:[],socialMedia:{instagram:"",twitter:"",blog:""},profileImage:""};console.log("⚠️ Hata durumunda fallback profil yüklendi:",e),je(e)}}),Ae=e=>d(null,null,function*(){var l,a,s,r;try{console.log("💾 Profil resmi kaydediliyor...",{user_id:null==D?void 0:D.id,imageUrl:e});const[t,i]=yield Promise.allSettled([m.auth.updateUser({data:{profile_image:e}}),m.from("writer_profiles").upsert({user_id:null==D?void 0:D.id,profile_image:e,updated_at:(new Date).toISOString()}).select()]);"rejected"===t.status||(null==(l=t.value)?void 0:l.error)?console.error("❌ User metadata profil resmi kaydedilemedi:",(null==(a=t.value)?void 0:a.error)||t.reason):console.log("✅ User metadata profil resmi kaydedildi!"),"rejected"===i.status||(null==(s=i.value)?void 0:s.error)?console.error("❌ Writer_profiles profil resmi kaydedilemedi:",(null==(r=i.value)?void 0:r.error)||i.reason):console.log("✅ Writer_profiles profil resmi kaydedildi!")}catch(t){throw console.error("❌ Profil resmi kaydetme hatası:",t),t}});return g.useEffect(()=>{var e,l,a,s,r;D&&(console.log("👤 Editör profil verisi yükleniyor:",D.user_metadata),ue({fullName:(null==(e=D.user_metadata)?void 0:e.full_name)||(null==(l=D.email)?void 0:l.split("@")[0])||"",email:D.email||"",authorName:(null==(a=D.user_metadata)?void 0:a.author_name)||(null==(s=D.email)?void 0:s.split("@")[0])||"",bio:(null==(r=D.user_metadata)?void 0:r.bio)||""}))},[D]),$?u.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),u.jsx("p",{className:"mt-4 text-gray-600",children:"Yükleniyor..."})]})}):T&&["editor","yazar","supervisor"].includes(null==(e=null==D?void 0:D.user_metadata)?void 0:e.user_role)?u.jsxs("div",{className:"min-h-screen bg-gray-50",children:[u.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:u.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex justify-between items-center h-16",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:u.jsx(v,{className:"h-5 w-5 text-green-600"})}),u.jsxs("div",{children:[u.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Editör Paneli"}),u.jsxs("p",{className:"text-sm text-gray-500",children:["Hoşgeldin, ",(null==(l=null==D?void 0:D.user_metadata)?void 0:l.full_name)||(null==(a=null==D?void 0:D.email)?void 0:a.split("@")[0])]})]})]}),u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsxs("span",{className:"text-sm text-gray-600",children:["📝 ",Z.length," yazınız"]}),u.jsxs("button",{onClick:()=>d(null,null,function*(){try{console.log("🚪 Editör çıkış yapıyor..."),yield K(),I("/",{replace:!0})}catch(e){console.error("❌ Çıkış hatası:",e)}}),className:"flex items-center space-x-2 px-3 py-1.5 rounded-lg text-sm font-medium text-red-600 bg-red-50 hover:bg-red-100 transition-colors",children:[u.jsx(j,{className:"h-4 w-4"}),u.jsx("span",{children:"Çıkış"})]})]})]})})}),u.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[u.jsx("div",{className:"flex space-x-6 mb-8",children:[{id:"posts",name:"Yazılarım",icon:v},{id:"new-post",name:"Yeni Yazı",icon:N},{id:"profile",name:"Profil",icon:w},{id:"security",name:"Güvenlik",icon:k}].map(e=>{const l=e.icon;return u.jsxs("button",{onClick:()=>W(e.id),className:"flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-colors "+(G===e.id?"bg-green-100 text-green-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:[u.jsx(l,{className:"h-4 w-4"}),u.jsx("span",{children:e.name})]},e.id)})}),"posts"===G&&u.jsx("div",{className:"space-y-6",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[u.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Yazılarım"}),u.jsxs("button",{onClick:()=>{W("new-post"),ne(null),ce(!1)},className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[u.jsx(N,{className:"h-4 w-4"}),u.jsx("span",{children:"Yeni Yazı"})]})]})}),u.jsx("div",{className:"overflow-x-auto",children:te?u.jsxs("div",{className:"p-8 text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"}),u.jsx("p",{className:"mt-2 text-gray-600",children:"Yazılar yükleniyor..."})]}):0===Z.length?u.jsxs("div",{className:"p-8 text-center",children:[u.jsx(v,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),u.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Henüz yazınız yok"}),u.jsx("p",{className:"text-gray-600 mb-4",children:'İlk yazınızı oluşturmak için "Yeni Yazı" butonuna tıklayın.'}),u.jsx("button",{onClick:()=>W("new-post"),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:"Yeni Yazı Oluştur"})]}):u.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[u.jsx("thead",{className:"bg-gray-50",children:u.jsxs("tr",{children:[u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Yazı"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kategori"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Durum"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tarih"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"İşlemler"})]})}),u.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Z.map(e=>u.jsxs("tr",{className:"hover:bg-gray-50",children:[u.jsx("td",{className:"px-6 py-4",children:u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.title}),u.jsx("p",{className:"text-sm text-gray-500 line-clamp-1 mt-1",children:e.excerpt})]})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:e.category_name})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("published"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-orange-100 text-orange-800":"rejected"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"published"===e.status?"Yayında":"pending"===e.status?"Onay Bekliyor":"rejected"===e.status?"Reddedildi":"Taslak"})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("tr-TR")}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsx("div",{className:"flex items-center space-x-2",children:u.jsx("button",{onClick:()=>{ne(e),W("new-post"),ce(!0)},className:"text-blue-600 hover:text-blue-900 transition-colors",title:"Düzenle",children:u.jsx(v,{className:"h-4 w-4"})})})})]},e.id))})]})})]})}),"new-post"===G&&u.jsx("div",{className:"space-y-6",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900",children:oe?"Yazıyı Düzenle":"Yeni Yazı Oluştur"}),u.jsx("button",{onClick:()=>{W("posts"),ne(null),ce(!1)},className:"text-gray-500 hover:text-gray-700 transition-colors",children:u.jsx(_,{className:"h-5 w-5"})})]}),u.jsx(b,{post:oe,categories:le,tags:se,onSave:()=>{Ye(),W("posts"),ne(null),ce(!1)},onCancel:()=>{W("posts"),ne(null),ce(!1)}})]})}),"profile"===G&&u.jsx("div",{className:"space-y-6",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Profil Bilgileri"}),u.jsx("button",{onClick:()=>Se(!ze),className:"text-primary-600 hover:text-primary-700 text-sm font-medium",children:ze?"Gizle":"Düzenle"})]}),!ze&&u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[u.jsx("div",{className:"lg:col-span-1 text-center lg:text-left",children:u.jsxs("div",{className:"text-center",children:[ve.profileImage?u.jsx("img",{src:ve.profileImage,alt:ve.name,className:"w-32 h-32 rounded-full mx-auto mb-4 object-cover"}):u.jsx("div",{className:"w-32 h-32 rounded-full mx-auto mb-4 bg-blue-500 flex items-center justify-center",children:u.jsx("span",{className:"text-white font-bold text-4xl",children:ve.firstName?ve.firstName.charAt(0).toUpperCase():ve.lastName?ve.lastName.charAt(0).toUpperCase():(null==(s=null==D?void 0:D.email)?void 0:s.charAt(0).toUpperCase())||"?"})}),u.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:`${ve.firstName} ${ve.lastName}`.trim()||(null==(r=null==D?void 0:D.email)?void 0:r.split("@")[0])}),u.jsx("p",{className:"text-gray-600 mt-1",children:ve.title||"Editör & Seyahat Yazarı"}),ve.location&&u.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["📍 ",ve.location]})]})}),u.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[ve.bio&&u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Hakkımda"}),u.jsx("p",{className:"text-gray-700",children:ve.bio})]}),ve.specialties&&ve.specialties.length>0&&u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Uzmanlık Alanları"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:ve.specialties.map((e,l)=>u.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:e},l))})]}),((null==(t=ve.socialMedia)?void 0:t.instagram)||(null==(i=ve.socialMedia)?void 0:i.twitter)||(null==(S=ve.socialMedia)?void 0:S.blog))&&u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Sosyal Medya"}),u.jsxs("div",{className:"space-y-2",children:[(null==(P=ve.socialMedia)?void 0:P.instagram)&&u.jsxs("p",{className:"text-sm text-gray-600",children:["📷 Instagram: ",ve.socialMedia.instagram]}),(null==(M=ve.socialMedia)?void 0:M.twitter)&&u.jsxs("p",{className:"text-sm text-gray-600",children:["🐦 Twitter: ",ve.socialMedia.twitter]}),(null==(Y=ve.socialMedia)?void 0:Y.blog)&&u.jsxs("p",{className:"text-sm text-gray-600",children:["📝 Blog: ",ve.socialMedia.blog]})]})]}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"İstatistikler"}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[u.jsx("p",{className:"text-2xl font-bold text-primary-600",children:Pe.length}),u.jsx("p",{className:"text-sm text-gray-600",children:"Toplam Yazı"})]}),u.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[u.jsx("p",{className:"text-2xl font-bold text-green-600",children:Pe.filter(e=>"published"===e.status).length}),u.jsx("p",{className:"text-sm text-gray-600",children:"Yayında"})]})]})]})]})]}),ze&&u.jsxs("div",{children:[u.jsx("h4",{className:"text-md font-medium text-gray-900 mb-4",children:"Profil Düzenle"}),ge&&u.jsx("div",{className:"mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded",children:ge}),fe&&u.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:fe}),u.jsxs("form",{onSubmit:e=>d(null,null,function*(){e.preventDefault(),xe(!0),he(""),ye("");try{const e=`${ve.firstName} ${ve.lastName}`.trim();console.log("🔄 Profil kaydediliyor (Hem user_metadata hem writer_profiles)...",{firstName:ve.firstName,lastName:ve.lastName,fullName:e,title:ve.title,bio:ve.bio,location:ve.location,profile_image:ve.profileImage,specialties:ve.specialties,socialMedia:ve.socialMedia});const l=Array.isArray(ve.specialties)?ve.specialties:[],a=ve.socialMedia&&"object"==typeof ve.socialMedia?ve.socialMedia:{};console.log("🔍 Metadata için güvenli veri:",{safeMetadataSpecialties:l,safeMetadataSocialMedia:a});const s={full_name:e,first_name:ve.firstName,last_name:ve.lastName,author_title:ve.title,bio:ve.bio,location:ve.location,profile_image:ve.profileImage};l.length>0&&(s.specialties=l),Object.keys(a).length>0&&(s.social_media=a),console.log("🔍 Kaydedilecek metadata verisi:",s);const{error:r}=yield m.auth.updateUser({data:s});if(r)return console.error("❌ User metadata güncelleme hatası:",r),void he("Profil güncellenemedi: "+r.message);const t=Array.isArray(ve.specialties)&&ve.specialties.length>0?ve.specialties:[],i=ve.socialMedia&&"object"==typeof ve.socialMedia?ve.socialMedia:{};console.log("🔍 Güvenli veri hazırlandı:",{safeSpecialties:t,safeSocialMedia:i,specialtiesType:typeof t,socialMediaType:typeof i});const o={user_id:null==D?void 0:D.id,name:e,title:ve.title,bio:ve.bio,location:ve.location,profile_image:ve.profileImage,updated_at:(new Date).toISOString()};t.length>0&&(o.specialties=t),Object.keys(i).length>0&&(o.social_media=i),console.log("🔍 Kaydedilecek profil verisi:",o);const{data:n,error:d}=yield m.from("writer_profiles").select("id").eq("user_id",null==D?void 0:D.id).single();let c=null;if(n){console.log("🔄 Mevcut profil güncelleniyor...",n.id);const{error:e}=yield m.from("writer_profiles").update(o).eq("user_id",null==D?void 0:D.id);c=e}else{console.log("➕ Yeni profil ekleniyor...");const{error:e}=yield m.from("writer_profiles").insert(o);c=e}if(c)return console.error("❌ Writer profiles güncelleme hatası:",c),void he("Profil güncellenemedi: "+c.message);if(e){const{error:l}=yield m.from("posts").update({author_name:e}).eq("author_id",null==D?void 0:D.id);l?console.error("❌ Yazılar güncelleme hatası:",l):console.log("✅ Tüm yazılardaki yazar adı güncellendi")}console.log("✅ Profil başarıyla güncellendi! (Hem user_metadata hem writer_profiles)"),ye("Profil başarıyla güncellendi! Ana sayfada da görünecek."),setTimeout(()=>{window.location.reload()},2e3)}catch(l){console.error("❌ Catch hatası:",l),he("Profil güncellenemedi: "+l.message)}finally{xe(!1)}}),className:"space-y-6",children:[u.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-6",children:[u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden bg-gray-200",children:Ne?u.jsx("img",{src:Ne,alt:"Profil",className:"w-full h-full object-cover"}):u.jsx("div",{className:"w-full h-full flex items-center justify-center bg-primary-600 text-white text-2xl font-bold",children:ve.firstName||ve.lastName?((null==(C=ve.firstName)?void 0:C[0])||(null==(E=ve.lastName)?void 0:E[0])||"?").toUpperCase():"?"})}),ke&&u.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center",children:u.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"})})]}),u.jsxs("div",{children:[u.jsxs("label",{className:"cursor-pointer bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors",children:["Resim Seç",u.jsx("input",{type:"file",accept:"image/*",onChange:e=>d(null,null,function*(){const l=e.target.files[0];if(l)if(l.size>5242880)alert("Dosya boyutu 5MB'dan büyük olamaz.");else if(l.type.startsWith("image/")){_e(!0);try{const e=`profile-${null==D?void 0:D.id}-${Date.now()}.${l.name.split(".").pop()}`,a=`profile-images/${e}`;console.log("📤 Supabase Storage'a yükleniyor...",{fileName:e,filePath:a});const{data:s,error:r}=yield m.storage.from("writer-profiles").upload(a,l,{cacheControl:"3600",upsert:!0,contentType:l.type});if(r)throw console.error("❌ Supabase Storage yükleme hatası:",r),r;const{data:{publicUrl:t}}=m.storage.from("writer-profiles").getPublicUrl(a);console.log("✅ Supabase Storage'a yüklendi:",t),yield Ae(t),yield Ue(),we(t),je(e=>n(o({},e),{profileImage:t})),alert("Profil fotoğrafı başarıyla yüklendi!")}catch(a){console.error("❌ Resim yükleme hatası:",a),alert("Resim yüklenirken hata oluştu: "+a.message)}finally{_e(!1)}}else alert("Sadece resim dosyaları yüklenebilir.")}),className:"hidden",disabled:ke})]}),u.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"JPG, PNG veya WebP (Max 5MB)"})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"İsim *"}),u.jsx("input",{type:"text",value:ve.firstName,onChange:e=>je(l=>n(o({},l),{firstName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Adınız",required:!0})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Soyisim *"}),u.jsx("input",{type:"text",value:ve.lastName,onChange:e=>je(l=>n(o({},l),{lastName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Soyadınız",required:!0})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),u.jsx("input",{type:"email",value:(null==D?void 0:D.email)||"",className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-600 cursor-not-allowed",placeholder:"Email adresiniz",disabled:!0,readOnly:!0}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email adresiniz değiştirilemez"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Unvan *"}),u.jsx("input",{type:"text",value:ve.title,onChange:e=>je(l=>n(o({},l),{title:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Örn: Editör & Seyahat Yazarı",required:!0})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hakkımda"}),u.jsx("textarea",{value:ve.bio,onChange:e=>je(l=>n(o({},l),{bio:e.target.value})),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Kendiniz hakkında kısa bir açıklama yazın..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lokasyon"}),u.jsx("input",{type:"text",value:ve.location,onChange:e=>je(l=>n(o({},l),{location:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Örn: İstanbul, Türkiye"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Uzmanlık Alanları"}),u.jsxs("div",{className:"space-y-3",children:[ve.specialties&&ve.specialties.length>0&&u.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:ve.specialties.map((e,l)=>u.jsxs("div",{className:"flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm",children:[u.jsx("span",{children:e}),u.jsx("button",{type:"button",onClick:()=>{const e=ve.specialties.filter((e,a)=>a!==l);je(l=>n(o({},l),{specialties:e}))},className:"ml-2 text-blue-600 hover:text-blue-800",children:"×"})]},l))}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("input",{type:"text",id:"newSpecialty",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Örn: Seyahat, Editörlük, Fotoğrafçılık",onKeyPress:e=>{if("Enter"===e.key){e.preventDefault();const l=e.target,a=l.value.trim();a&&!ve.specialties.includes(a)&&(je(e=>n(o({},e),{specialties:[...e.specialties||[],a]})),l.value="")}}}),u.jsx("button",{type:"button",onClick:()=>{const e=document.getElementById("newSpecialty"),l=e.value.trim();l&&!ve.specialties.includes(l)&&(je(e=>n(o({},e),{specialties:[...e.specialties||[],l]})),e.value="")},className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors",children:"Ekle"})]}),u.jsx("p",{className:"text-xs text-gray-500",children:'Uzmanlık alanını yazın ve Enter tuşuna basın veya "Ekle" butonuna tıklayın'})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Instagram"}),u.jsx("input",{type:"text",value:(null==(U=ve.socialMedia)?void 0:U.instagram)||"",onChange:e=>je(l=>n(o({},l),{socialMedia:n(o({},l.socialMedia||{}),{instagram:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"@kullanici_adi"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Twitter"}),u.jsx("input",{type:"text",value:(null==(A=ve.socialMedia)?void 0:A.twitter)||"",onChange:e=>je(l=>n(o({},l),{socialMedia:n(o({},l.socialMedia||{}),{twitter:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"@kullanici_adi"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Blog/Website"}),u.jsx("input",{type:"url",value:(null==(O=ve.socialMedia)?void 0:O.blog)||"",onChange:e=>je(l=>n(o({},l),{socialMedia:n(o({},l.socialMedia||{}),{blog:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"https://website.com"})]})]}),u.jsx("div",{className:"flex justify-end",children:u.jsxs("button",{type:"submit",disabled:pe,className:"bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 disabled:opacity-50 transition-colors flex items-center space-x-2",children:[u.jsx(z,{className:"h-4 w-4"}),u.jsx("span",{children:pe?"Kaydediliyor...":"Profili Kaydet"})]})})]})]})]})}),!1,"security"===G&&u.jsx("div",{className:"space-y-6",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:"Güvenlik Ayarları"}),J&&u.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:u.jsx("p",{className:"text-green-700 text-sm",children:J})}),V&&u.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:u.jsx("p",{className:"text-red-600 text-sm",children:V})}),u.jsx("form",{onSubmit:e=>d(null,null,function*(){if(e.preventDefault(),H.newPassword===H.confirmPassword)if(H.newPassword.length<6)X("Yeni şifre en az 6 karakter olmalıdır!");else{F(!0),X(""),Q("");try{const{error:e}=yield m.auth.signInWithPassword({email:D.email,password:H.currentPassword});if(e)return X("Mevcut şifre yanlış!"),void F(!1);const{error:l}=yield m.auth.updateUser({password:H.newPassword});l?X(`Şifre güncellenemedi: ${l.message}`):(Q("Şifreniz başarıyla güncellendi!"),R({currentPassword:"",newPassword:"",confirmPassword:""}))}catch(l){console.error("Şifre değiştirme hatası:",l),X("Beklenmeyen bir hata oluştu!")}finally{F(!1)}}else X("Yeni şifreler eşleşmiyor!")}),children:u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mevcut Şifre *"}),u.jsx("input",{type:"password",value:H.currentPassword,onChange:e=>R(l=>n(o({},l),{currentPassword:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Mevcut şifrenizi girin",required:!0})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yeni Şifre *"}),u.jsx("input",{type:"password",value:H.newPassword,onChange:e=>R(l=>n(o({},l),{newPassword:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Yeni şifrenizi girin (en az 6 karakter)",required:!0,minLength:6})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yeni Şifre Tekrar *"}),u.jsx("input",{type:"password",value:H.confirmPassword,onChange:e=>R(l=>n(o({},l),{confirmPassword:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Yeni şifrenizi tekrar girin",required:!0})]}),u.jsx("div",{className:"flex justify-end",children:u.jsxs("button",{type:"submit",disabled:L,className:"bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 disabled:opacity-50 transition-colors flex items-center space-x-2",children:[u.jsx(k,{className:"h-4 w-4"}),u.jsx("span",{children:L?"Güncelleniyor...":"Şifreyi Güncelle"})]})})]})})]})})]})]}):null};export{S as default};
