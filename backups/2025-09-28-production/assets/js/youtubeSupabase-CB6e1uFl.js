var e=(e,r,t)=>new Promise((o,i)=>{var n=e=>{try{a(t.next(e))}catch(r){i(r)}},l=e=>{try{a(t.throw(e))}catch(r){i(r)}},a=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,l);a((t=t.apply(e,r)).next())});import{s as r}from"./index-D5E9gJaD.js";import"./react-vendor-9pH4USaU.js";import"./supabase-Cd1B4uHG.js";import"./utils-Dxy8Veww.js";import"./ui-vendor-BW9IHOa4.js";const t=e=>{const r=[/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/,/(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/)([a-zA-Z0-9_-]{11})/,/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/,/^([a-zA-Z0-9_-]{11})$/];for(const t of r){const r=e.match(t);if(r)return r[1]}return null},o=r=>e(null,null,function*(){try{const e=yield fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${r}&format=json`);if(!e.ok)throw new Error("Video bulunamadı");const t=yield e.json();return{video_id:r,title:t.title,description:t.author_name,thumbnail_url:t.thumbnail_url,channel_name:t.author_name,views_count:"N/A",upload_date:"Yeni",duration:"N/A"}}catch(e){throw console.error("Video bilgisi alınamadı:",e),e}}),i={getAll(){return e(this,null,function*(){try{const{data:e,error:t}=yield r.rpc("get_active_youtube_videos");return t?(console.error("YouTube videoları getirilemedi:",t),{data:[],error:t}):{data:e||[],error:null}}catch(e){return console.error("YouTube videoları getirilemedi:",e),{data:[],error:e}}})},add(t){return e(this,null,function*(){try{const{data:e,error:o}=yield r.from("youtube_videos").select("id").eq("video_id",t.video_id).single();if(e)throw new Error("Bu video zaten listede mevcut");const{data:i,error:n}=yield r.from("youtube_videos").insert([{video_id:t.video_id,title:t.title,description:t.description||t.title,thumbnail_url:t.thumbnail_url,channel_name:t.channel_name,views_count:t.views_count||"N/A",upload_date:t.upload_date||"Yeni",duration:t.duration||"N/A",display_order:0}]).select().single();return n?(console.error("Video eklenemedi:",n),{data:null,error:n}):{data:i,error:null}}catch(e){return console.error("Video eklenemedi:",e),{data:null,error:e}}})},update(t,o){return e(this,null,function*(){try{const{data:e,error:i}=yield r.from("youtube_videos").update(o).eq("id",t).select().single();return i?(console.error("Video güncellenemedi:",i),{data:null,error:i}):{data:e,error:null}}catch(e){return console.error("Video güncellenemedi:",e),{data:null,error:e}}})},delete(t){return e(this,null,function*(){try{const{error:e}=yield r.from("youtube_videos").delete().eq("id",t);return e?(console.error("Video silinemedi:",e),{error:e}):{error:null}}catch(e){return console.error("Video silinemedi:",e),{error:e}}})},reorder(t){return e(this,null,function*(){try{const{error:e}=yield r.rpc("reorder_youtube_videos",{video_ids:t});return e?(console.error("Video sırası değiştirilemedi:",e),{error:e}):{error:null}}catch(e){return console.error("Video sırası değiştirilemedi:",e),{error:e}}})},toggleActive(t,o){return e(this,null,function*(){try{const{data:e,error:i}=yield r.from("youtube_videos").update({is_active:o}).eq("id",t).select().single();return i?(console.error("Video durumu değiştirilemedi:",i),{data:null,error:i}):{data:e,error:null}}catch(e){return console.error("Video durumu değiştirilemedi:",e),{data:null,error:e}}})}},n=()=>e(null,null,function*(){try{const r="joinescapes_youtube_videos",t=localStorage.getItem(r);if(!t)return{success:!0,migrated:0};const o=JSON.parse(t);if(!Array.isArray(o)||0===o.length)return{success:!0,migrated:0};let n=0;for(const l of o)try{const e=yield i.add({video_id:l.id,title:l.title,description:l.description,channel_name:l.channel,views_count:l.views||"N/A",upload_date:l.date||"Yeni",duration:l.duration||"N/A"});e.error?console.warn(`⚠️ Video aktarılamadı: ${l.title}`,e.error):n++}catch(e){console.warn(`⚠️ Video aktarılamadı: ${l.title}`,e)}return n>0&&localStorage.removeItem(r),{success:!0,migrated:n}}catch(e){return console.error("Migration hatası:",e),{success:!1,error:e}}});export{t as extractVideoId,o as fetchVideoInfo,n as migrateLocalStorageToSupabase,i as youtubeVideoService};
