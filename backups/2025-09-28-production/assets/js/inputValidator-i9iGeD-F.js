const e=new class{constructor(){this.requests=new Map,this.windowMs=9e5,this.maxRequests=1e3,this.blockDuration=3e5}getClientId(){const e=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,(new Date).getTimezoneOffset(),navigator.hardwareConcurrency||"unknown"].join("|");return btoa(e).slice(0,32)}checkRateLimit(e="default"){const i=this.getClientId(),t=`${i}:${e}`,s=Date.now();if(this.cleanup(),!this.requests.has(t))return this.requests.set(t,{count:1,firstRequest:s,blocked:!1,blockUntil:null}),{allowed:!0,remaining:this.maxRequests-1};const r=this.requests.get(t);if(r.blocked&&r.blockUntil>s){const e=Math.ceil((r.blockUntil-s)/1e3);return{allowed:!1,remaining:0,resetTime:e,message:`Ã‡ok fazla istek gÃ¶nderdiniz. ${e} saniye sonra tekrar deneyin.`}}return r.blocked&&r.blockUntil<=s?(r.blocked=!1,r.blockUntil=null,r.count=1,r.firstRequest=s,{allowed:!0,remaining:this.maxRequests-1}):s-r.firstRequest>this.windowMs?(r.count=1,r.firstRequest=s,{allowed:!0,remaining:this.maxRequests-1}):(r.count++,r.count>this.maxRequests?(r.blocked=!0,r.blockUntil=s+this.blockDuration,console.warn(`ðŸš¨ Rate limit aÅŸÄ±ldÄ±: ${e} - Client: ${i}`),{allowed:!1,remaining:0,resetTime:Math.ceil(this.blockDuration/1e3),message:`Ã‡ok fazla istek gÃ¶nderdiniz. ${Math.ceil(this.blockDuration/1e3/60)} dakika sonra tekrar deneyin.`}):{allowed:!0,remaining:this.maxRequests-r.count})}cleanup(){const e=Date.now()-this.windowMs;for(const[i,t]of this.requests.entries())!t.blocked&&t.firstRequest<e&&this.requests.delete(i)}checkEndpointLimit(e,i=null){i||this.maxRequests;const t=this.maxRequests;i&&(this.maxRequests=i);const s=this.checkRateLimit(e);return this.maxRequests=t,s}checkCriticalEndpoint(e){return this.checkEndpointLimit(e,100)}checkAuthEndpoint(e){return this.checkEndpointLimit(e,50)}};const i=new class{constructor(){this.dangerousPatterns=[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/javascript:/gi,/vbscript:/gi,/onload\s*=/gi,/onerror\s*=/gi,/onclick\s*=/gi,/onmouseover\s*=/gi,/onfocus\s*=/gi,/onblur\s*=/gi,/onchange\s*=/gi,/onsubmit\s*=/gi,/<iframe\b[^>]*>/gi,/<object\b[^>]*>/gi,/<embed\b[^>]*>/gi,/<form\b[^>]*>/gi,/data:text\/html/gi,/data:application\/x-httpd-php/gi,/\beval\s*\(/gi,/\bsetTimeout\s*\(/gi,/\bsetInterval\s*\(/gi,/document\.write/gi,/document\.writeln/gi,/window\.location/gi,/document\.location/gi,/document\.cookie/gi,/localStorage\./gi,/sessionStorage\./gi],this.sqlPatterns=[/(\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|UNION|SCRIPT)\b)/gi,/[';\\|*%<>{}[\]()]/gi,/((\%3C)|<)((\%2F)|\/)*[a-z0-9\%]+((\%3E)|>)/gi,/((\%3C)|<)((\%69)|i|(\%49))((\%6D)|m|(\%4D))((\%67)|g|(\%47))[^\n]+((\%3E)|>)/gi],this.xssPatterns=[/(<|%3C)script(.|\n)*?(>|%3E)/gi,/(<|%3C)\/script(.|\n)*?(>|%3E)/gi,/(javascript|vbscript|onload|onerror|onclick):/gi,/&#x?[0-9a-f]+;?/gi,/&[a-z]+;/gi]}validateText(e,i={}){const{maxLength:t=1e3,minLength:s=0,allowHtml:r=!1,allowSpecialChars:a=!0,required:n=!1}=i,o=[];if(n&&(!e||0===e.trim().length))return o.push("Bu alan gereklidir"),{isValid:!1,errors:o,sanitized:""};if(!e)return{isValid:!0,errors:[],sanitized:""};e.length>t&&o.push(`Maksimum ${t} karakter olmalÄ±dÄ±r`),e.length<s&&o.push(`Minimum ${s} karakter olmalÄ±dÄ±r`);let l=e;if(!r){for(const i of this.xssPatterns)if(i.test(e)){o.push("GÃ¼venlik nedeniyle izin verilmeyen karakterler iÃ§eriyor");break}for(const i of this.dangerousPatterns)if(i.test(e)){o.push("GÃ¼venlik nedeniyle izin verilmeyen iÃ§erik");break}l=e.replace(/<[^>]*>/g,"")}for(const c of this.sqlPatterns)if(c.test(e)){o.push("GÃ¼venlik nedeniyle izin verilmeyen SQL ifadeleri");break}if(!a){const i=/[<>'"&]/g;i.test(e)&&(o.push("Ã–zel karakterler (<, >, \", ', &) kullanÄ±lamaz"),l=e.replace(i,""))}return{isValid:0===o.length,errors:o,sanitized:l.trim()}}validateEmail(e){const i=[];if(!e)return i.push("E-posta adresi gereklidir"),{isValid:!1,errors:i};/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||i.push("GeÃ§erli bir e-posta adresi giriniz"),e.length>254&&i.push("E-posta adresi Ã§ok uzun");const t=this.validateText(e,{allowHtml:!1,allowSpecialChars:!1});return t.isValid||i.push(...t.errors),{isValid:0===i.length,errors:i,sanitized:e.toLowerCase().trim()}}validatePassword(e){const i=[];if(!e)return i.push("Åžifre gereklidir"),{isValid:!1,errors:i};e.length<6&&i.push("Åžifre en az 6 karakter olmalÄ±dÄ±r"),e.length>128&&i.push("Åžifre Ã§ok uzun");const t=this.validateText(e,{allowHtml:!1,maxLength:128});return t.isValid||i.push(...t.errors),{isValid:0===i.length,errors:i}}validateUrl(e){const i=[];if(!e)return{isValid:!0,errors:[],sanitized:""};try{const t=new URL(e);["http:","https:"].includes(t.protocol)||i.push("Sadece HTTP ve HTTPS URL'leri kabul edilir"),["javascript:","vbscript:","data:"].includes(t.protocol)&&i.push("GÃ¼venlik nedeniyle bu protokole izin verilmiyor")}catch(t){i.push("GeÃ§erli bir URL giriniz")}return{isValid:0===i.length,errors:i,sanitized:e.trim()}}validateYouTubeUrl(e){const i=[];if(!e)return i.push("YouTube URL gereklidir"),{isValid:!1,errors:i};const t=this.validateUrl(e);if(!t.isValid)return t;return/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/i.test(e)||i.push("GeÃ§erli bir YouTube URL'si giriniz"),{isValid:0===i.length,errors:i,sanitized:e.trim()}}validateForm(e,i){const t={};let s=!0;for(const[r,a]of Object.entries(i)){const i=e[r];let n;switch(a.type){case"text":default:n=this.validateText(i,a.options||{});break;case"email":n=this.validateEmail(i);break;case"password":n=this.validatePassword(i);break;case"url":n=this.validateUrl(i);break;case"youtube":n=this.validateYouTubeUrl(i)}n.isValid||(t[r]=n.errors,s=!1)}return{isValid:s,errors:t}}};export{i,e as r};
