var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(l,a,s)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[a]=s,o=(e,l)=>{for(var a in l||(l={}))t.call(l,a)&&r(e,a,l[a]);if(s)for(var a of s(l))i.call(l,a)&&r(e,a,l[a]);return e},n=(e,s)=>l(e,a(s)),d=(e,l,a)=>new Promise((s,t)=>{var i=e=>{try{o(a.next(e))}catch(l){t(l)}},r=e=>{try{o(a.throw(e))}catch(l){t(l)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,r);o((a=a.apply(e,l)).next())});import{u as c,s as m,j as u}from"./index-D5E9gJaD.js";import{u as p,c as x,r as g}from"./react-vendor-9pH4USaU.js";import{a as y,b as f}from"./blog-DLvBI2aM.js";import{b as h}from"./tags-BzMW1mdI.js";import{P as b}from"./PostForm-Cgd7MKzh.js";import{o as v,m as j,s as N,l as _,X as w,p as k}from"./ui-vendor-BW9IHOa4.js";import"./supabase-Cd1B4uHG.js";import"./utils-Dxy8Veww.js";const z=()=>{var e,l,a,s,t,i,r,z,S,M,Y,P,C;const O=p(),{user:E,isAuthenticated:I,loading:A,signOut:D,getCurrentUser:K}=c(),{slug:T}=x(),[U,B]=g.useState("posts"),[q,R]=g.useState([]),[$,H]=g.useState([]),[L,V]=g.useState([]),[W,G]=g.useState(!1),[J,F]=g.useState(null),[Q,X]=g.useState(!1),[Z,ee]=g.useState({fullName:"",email:"",authorName:"",bio:""}),[le,ae]=g.useState(!1),[se,te]=g.useState(""),[ie,re]=g.useState(""),oe=g.useCallback(e=>{var l,a,s,t;if(!e)return"";const i=(null==(l=e.user_metadata)?void 0:l.full_name)||(null==(a=e.email)?void 0:a.split("@")[0])||"kullanici";console.log("🔍 Slug oluşturuluyor:",{user_email:e.email,user_metadata:e.user_metadata,full_name:null==(s=e.user_metadata)?void 0:s.full_name,email_name:null==(t=e.email)?void 0:t.split("@")[0],final_fullName:i});const r=i.toLowerCase().replace(/ğ/g,"g").replace(/ü/g,"u").replace(/ş/g,"s").replace(/ı/g,"i").replace(/ö/g,"o").replace(/ç/g,"c").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-");return console.log("✅ Oluşturulan slug:",r),r},[]);g.useEffect(()=>{var e,l,a,s,t,i;if(!A){if(console.log("🔍 Auth check başlıyor:",{loading:A,isAuthenticated:I,user_email:null==E?void 0:E.email,user_id:null==E?void 0:E.id,user_role:null==(e=null==E?void 0:E.user_metadata)?void 0:e.user_role,editor_approved:null==(l=null==E?void 0:E.user_metadata)?void 0:l.editor_approved,current_slug:T}),!I&&!A)return console.log("🚪 Kullanıcı giriş yapmamış, ana sayfaya yönlendiriliyor"),void O("/");if(I&&E&&E.id){const e=null==(a=null==E?void 0:E.user_metadata)?void 0:a.user_role;if(console.log("👤 Kullanıcı kontrolü:",{email:E.email,role:e,approved:null==(s=E.user_metadata)?void 0:s.editor_approved}),"test@test.com"===E.email)return console.log("🔑 Admin kullanıcı, admin paneline yönlendiriliyor"),void O("/admin");if("editor"!==e&&"yazar"!==e||!(null==(t=E.user_metadata)?void 0:t.editor_approved))return console.log("❌ Yetkisiz kullanıcı veya onaylanmamış editör:",{role:e,approved:null==(i=E.user_metadata)?void 0:i.editor_approved}),void O("/");if(console.log("✅ Kullanıcı yetkili, slug kontrolü yapılıyor..."),!T){const e=oe(E);return console.log("🔄 Slug yok, kullanıcı slug'ı ile yönlendiriliyor:",`/yazar/profil/${e}`),void O(`/yazar/profil/${e}`,{replace:!0})}{const e=oe(E);if(console.log("🔍 Slug karşılaştırması:",{current_slug:T,user_slug:e,match:T===e}),T!==e)return console.log("🔄 Yanlış slug, doğru URL'ye yönlendiriliyor:",`/yazar/profil/${e}`),void O(`/yazar/profil/${e}`,{replace:!0})}}}},[A,I,E,O,T,oe]),g.useEffect(()=>{I&&E&&(d(null,null,function*(){try{console.log("🎨 Editör paneli yükleniyor...");const[e,l,a]=yield Promise.allSettled([he(),be(),ve()]);console.log("✅ Editör verileri yüklendi:",{posts:e.status,categories:l.status,tags:a.status})}catch(e){console.error("❌ Editör init hatası:",e)}}),je())},[I,null==E?void 0:E.id]);const[ne,de]=g.useState({firstName:"",lastName:"",title:"",bio:"",location:"",specialties:[],socialMedia:{instagram:"",twitter:"",blog:""},profileImage:""}),[ce,me]=g.useState(""),[ue,pe]=g.useState(!1),[xe,ge]=g.useState(!1),[ye,fe]=g.useState([]),he=()=>d(null,null,function*(){G(!0);try{const{data:e,error:l}=yield y.getAll({authorId:null==E?void 0:E.id,orderBy:"created_at",orderDirection:"desc"});!l&&e?(R(e),fe(e),console.log("✅ Editör yazıları yüklendi:",e.length,"yazı")):console.error("❌ Yazılar yüklenemedi:",l)}catch(e){console.error("❌ Yazı fetch hatası:",e)}finally{G(!1)}}),be=()=>d(null,null,function*(){const{data:e,error:l}=yield f.getAll();!l&&e&&H(e)}),ve=()=>d(null,null,function*(){const{data:e,error:l}=yield h.getAll();!l&&e&&V(e)}),je=()=>d(null,null,function*(){var e,l;try{const{data:a,error:s}=yield m.from("writer_profiles").select("*").eq("user_id",null==E?void 0:E.id).single();if(a&&!s){const l=(a.name||(null==(e=null==E?void 0:E.email)?void 0:e.split("@")[0])||"").split(" "),s=l[0]||"",t={firstName:s,lastName:l.slice(1).join(" ")||"",title:a.title||"Editör & Seyahat Yazarı",bio:a.bio||"",location:a.location||"",specialties:"string"==typeof a.specialties?JSON.parse(a.specialties):a.specialties||[],socialMedia:"string"==typeof a.social_media?JSON.parse(a.social_media):a.social_media||{instagram:"",twitter:"",blog:""},profileImage:a.profile_image||""};de(t),me(a.profile_image||""),console.log("✅ Profil writer_profiles tablosundan yüklendi!",t)}else{const e=(null==E?void 0:E.user_metadata)||{};if(console.log("🔍 User metadata kontrolü:",{full_name:e.full_name,author_title:e.author_title,has_full_name:!!e.full_name,has_author_title:!!e.author_title}),e.full_name||e.author_title)console.log("ℹ️ User metadata'da profil verisi var, varsayılan profil oluşturulmayacak");else{console.log("🆕 Editör için profil verisi bulunamadı, varsayılan profil oluşturuluyor..."),console.log("👤 Kullanıcı bilgileri:",{email:null==E?void 0:E.email,user_id:null==E?void 0:E.id,user_metadata:null==E?void 0:E.user_metadata});const e=yield d(null,null,function*(){var e;try{console.log("🆕 Yeni editör için varsayılan profil oluşturuluyor...");const l=((null==E?void 0:E.email)||"").split("@")[0]||"Editör",a=(null==(e=null==E?void 0:E.user_metadata)?void 0:e.full_name)||l,s=a.split(" "),t=s[0]||l,i=s.slice(1).join(" ")||"",r={firstName:t,lastName:i,title:"Editör & Seyahat Yazarı",bio:"Ben Sez geliyorums",location:"İstanbul",specialties:["Seyahat","Editörlük"],socialMedia:{instagram:"@sezaidemirer",twitter:"@sezaidemirer",blog:"Kişisel Blog"},profileImage:"https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80"},{error:o}=yield m.auth.updateUser({data:{full_name:a,first_name:t,last_name:i,author_title:r.title,bio:r.bio,location:r.location,specialties:r.specialties,social_media:r.socialMedia,profile_image:r.profileImage}});if(o)return console.error("❌ Varsayılan profil oluşturulamadı:",o),null;const{error:n}=yield m.from("writer_profiles").insert({user_id:null==E?void 0:E.id,name:a,title:r.title,bio:r.bio,location:r.location,profile_image:r.profileImage,join_date:(new Date).toISOString(),followers:0,specialties:r.specialties,social_media:r.socialMedia});return n?console.error("❌ Writer profile oluşturulamadı:",n):console.log("✅ Varsayılan profil oluşturuldu!"),r}catch(l){return console.error("❌ Varsayılan profil oluşturma hatası:",l),null}});if(e)return de(e),me(e.profileImage),void console.log("✅ Varsayılan profil yüklendi!",e);console.log("❌ Varsayılan profil oluşturulamadı!")}const a=(e.full_name||(null==(l=null==E?void 0:E.email)?void 0:l.split("@")[0])||"").split(" "),s=a[0]||"",t={firstName:s,lastName:a.slice(1).join(" ")||"",title:e.author_title||"Editör & Seyahat Yazarı",bio:e.bio||"",location:e.location||"",specialties:e.specialties||[],socialMedia:e.social_media||{instagram:"",twitter:"",blog:""},profileImage:e.profile_image||""};de(t),me(e.profile_image||""),console.log("✅ Profil user metadata'dan yüklendi!",t)}}catch(a){console.error("❌ Yazar profili yüklenemedi:",a)}});return g.useEffect(()=>{var e,l,a,s,t;E&&(console.log("👤 Editör profil verisi yükleniyor:",E.user_metadata),ee({fullName:(null==(e=E.user_metadata)?void 0:e.full_name)||(null==(l=E.email)?void 0:l.split("@")[0])||"",email:E.email||"",authorName:(null==(a=E.user_metadata)?void 0:a.author_name)||(null==(s=E.email)?void 0:s.split("@")[0])||"",bio:(null==(t=E.user_metadata)?void 0:t.bio)||""}))},[E]),A?u.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),u.jsx("p",{className:"mt-4 text-gray-600",children:"Yükleniyor..."})]})}):I&&["editor","yazar","supervisor"].includes(null==(e=null==E?void 0:E.user_metadata)?void 0:e.user_role)?u.jsxs("div",{className:"min-h-screen bg-gray-50",children:[u.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:u.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex justify-between items-center h-16",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:u.jsx(v,{className:"h-5 w-5 text-green-600"})}),u.jsxs("div",{children:[u.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Editör Paneli"}),u.jsxs("p",{className:"text-sm text-gray-500",children:["Hoşgeldin, ",(null==(l=null==E?void 0:E.user_metadata)?void 0:l.full_name)||(null==(a=null==E?void 0:E.email)?void 0:a.split("@")[0])]})]})]}),u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsxs("span",{className:"text-sm text-gray-600",children:["📝 ",q.length," yazınız"]}),u.jsxs("button",{onClick:()=>d(null,null,function*(){try{console.log("🚪 Editör çıkış yapıyor..."),yield D(),O("/",{replace:!0})}catch(e){console.error("❌ Çıkış hatası:",e)}}),className:"flex items-center space-x-2 px-3 py-1.5 rounded-lg text-sm font-medium text-red-600 bg-red-50 hover:bg-red-100 transition-colors",children:[u.jsx(j,{className:"h-4 w-4"}),u.jsx("span",{children:"Çıkış"})]})]})]})})}),u.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[u.jsx("div",{className:"flex space-x-6 mb-8",children:[{id:"posts",name:"Yazılarım",icon:v},{id:"new-post",name:"Yeni Yazı",icon:N},{id:"profile",name:"Profil",icon:_}].map(e=>{const l=e.icon;return u.jsxs("button",{onClick:()=>B(e.id),className:"flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-colors "+(U===e.id?"bg-green-100 text-green-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:[u.jsx(l,{className:"h-4 w-4"}),u.jsx("span",{children:e.name})]},e.id)})}),"posts"===U&&u.jsx("div",{className:"space-y-6",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[u.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Yazılarım"}),u.jsxs("button",{onClick:()=>{B("new-post"),F(null),X(!1)},className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[u.jsx(N,{className:"h-4 w-4"}),u.jsx("span",{children:"Yeni Yazı"})]})]})}),u.jsx("div",{className:"overflow-x-auto",children:W?u.jsxs("div",{className:"p-8 text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"}),u.jsx("p",{className:"mt-2 text-gray-600",children:"Yazılar yükleniyor..."})]}):0===q.length?u.jsxs("div",{className:"p-8 text-center",children:[u.jsx(v,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),u.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Henüz yazınız yok"}),u.jsx("p",{className:"text-gray-600 mb-4",children:'İlk yazınızı oluşturmak için "Yeni Yazı" butonuna tıklayın.'}),u.jsx("button",{onClick:()=>B("new-post"),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:"Yeni Yazı Oluştur"})]}):u.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[u.jsx("thead",{className:"bg-gray-50",children:u.jsxs("tr",{children:[u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Yazı"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kategori"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Durum"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tarih"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"İşlemler"})]})}),u.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:q.map(e=>u.jsxs("tr",{className:"hover:bg-gray-50",children:[u.jsx("td",{className:"px-6 py-4",children:u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:e.title}),u.jsx("p",{className:"text-sm text-gray-500 line-clamp-1 mt-1",children:e.excerpt})]})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:e.category_name})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("published"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-orange-100 text-orange-800":"rejected"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"published"===e.status?"Yayında":"pending"===e.status?"Onay Bekliyor":"rejected"===e.status?"Reddedildi":"Taslak"})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("tr-TR")}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsx("div",{className:"flex items-center space-x-2",children:u.jsx("button",{onClick:()=>{F(e),B("new-post"),X(!0)},className:"text-blue-600 hover:text-blue-900 transition-colors",title:"Düzenle",children:u.jsx(v,{className:"h-4 w-4"})})})})]},e.id))})]})})]})}),"new-post"===U&&u.jsx("div",{className:"space-y-6",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900",children:J?"Yazıyı Düzenle":"Yeni Yazı Oluştur"}),u.jsx("button",{onClick:()=>{B("posts"),F(null),X(!1)},className:"text-gray-500 hover:text-gray-700 transition-colors",children:u.jsx(w,{className:"h-5 w-5"})})]}),u.jsx(b,{post:J,categories:$,tags:L,onSave:()=>{he(),B("posts"),F(null),X(!1)},onCancel:()=>{B("posts"),F(null),X(!1)}})]})}),"profile"===U&&u.jsx("div",{className:"space-y-6",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Profil Bilgileri"}),u.jsx("button",{onClick:()=>ge(!xe),className:"text-primary-600 hover:text-primary-700 text-sm font-medium",children:xe?"Gizle":"Düzenle"})]}),!xe&&u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[u.jsx("div",{className:"lg:col-span-1",children:u.jsxs("div",{className:"text-center",children:[ne.profileImage?u.jsx("img",{src:ne.profileImage,alt:ne.name,className:"w-32 h-32 rounded-full mx-auto mb-4 object-cover"}):u.jsx("div",{className:"w-32 h-32 rounded-full mx-auto mb-4 bg-gray-200 flex items-center justify-center",children:u.jsx(_,{className:"h-16 w-16 text-gray-400"})}),u.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:`${ne.firstName} ${ne.lastName}`.trim()||(null==(s=null==E?void 0:E.email)?void 0:s.split("@")[0])}),u.jsx("p",{className:"text-gray-600 mt-1",children:ne.title||"Editör & Seyahat Yazarı"}),ne.location&&u.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["📍 ",ne.location]})]})}),u.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[ne.bio&&u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Hakkımda"}),u.jsx("p",{className:"text-gray-700",children:ne.bio})]}),ne.specialties&&ne.specialties.length>0&&u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Uzmanlık Alanları"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:ne.specialties.map((e,l)=>u.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:e},l))})]}),((null==(t=ne.socialMedia)?void 0:t.instagram)||(null==(i=ne.socialMedia)?void 0:i.twitter)||(null==(r=ne.socialMedia)?void 0:r.blog))&&u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Sosyal Medya"}),u.jsxs("div",{className:"space-y-2",children:[(null==(z=ne.socialMedia)?void 0:z.instagram)&&u.jsxs("p",{className:"text-sm text-gray-600",children:["📷 Instagram: ",ne.socialMedia.instagram]}),(null==(S=ne.socialMedia)?void 0:S.twitter)&&u.jsxs("p",{className:"text-sm text-gray-600",children:["🐦 Twitter: ",ne.socialMedia.twitter]}),(null==(M=ne.socialMedia)?void 0:M.blog)&&u.jsxs("p",{className:"text-sm text-gray-600",children:["📝 Blog: ",ne.socialMedia.blog]})]})]}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"İstatistikler"}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[u.jsx("p",{className:"text-2xl font-bold text-primary-600",children:ye.length}),u.jsx("p",{className:"text-sm text-gray-600",children:"Toplam Yazı"})]}),u.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[u.jsx("p",{className:"text-2xl font-bold text-green-600",children:ye.filter(e=>"published"===e.status).length}),u.jsx("p",{className:"text-sm text-gray-600",children:"Yayında"})]})]})]})]})]}),xe&&u.jsxs("div",{children:[u.jsx("h4",{className:"text-md font-medium text-gray-900 mb-4",children:"Profil Düzenle"}),se&&u.jsx("div",{className:"mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded",children:se}),ie&&u.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:ie}),u.jsxs("form",{onSubmit:e=>d(null,null,function*(){e.preventDefault(),ae(!0),re(""),te("");try{const e=`${ne.firstName} ${ne.lastName}`.trim();console.log("🔄 Profil kaydediliyor (Hem user_metadata hem writer_profiles)...",{firstName:ne.firstName,lastName:ne.lastName,fullName:e,title:ne.title,bio:ne.bio,location:ne.location,profile_image:ne.profileImage,specialties:ne.specialties,socialMedia:ne.socialMedia});const l=Array.isArray(ne.specialties)?ne.specialties:[],a=ne.socialMedia&&"object"==typeof ne.socialMedia?ne.socialMedia:{};console.log("🔍 Metadata için güvenli veri:",{safeMetadataSpecialties:l,safeMetadataSocialMedia:a});const s={full_name:e,first_name:ne.firstName,last_name:ne.lastName,author_title:ne.title,bio:ne.bio,location:ne.location,profile_image:ne.profileImage};l.length>0&&(s.specialties=l),Object.keys(a).length>0&&(s.social_media=a),console.log("🔍 Kaydedilecek metadata verisi:",s);const{error:t}=yield m.auth.updateUser({data:s});if(t)return console.error("❌ User metadata güncelleme hatası:",t),void re("Profil güncellenemedi: "+t.message);const i=Array.isArray(ne.specialties)&&ne.specialties.length>0?ne.specialties:[],r=ne.socialMedia&&"object"==typeof ne.socialMedia?ne.socialMedia:{};console.log("🔍 Güvenli veri hazırlandı:",{safeSpecialties:i,safeSocialMedia:r,specialtiesType:typeof i,socialMediaType:typeof r});const o={user_id:null==E?void 0:E.id,name:e,title:ne.title,bio:ne.bio,location:ne.location,profile_image:ne.profileImage,updated_at:(new Date).toISOString()};i.length>0&&(o.specialties=i),Object.keys(r).length>0&&(o.social_media=r),console.log("🔍 Kaydedilecek profil verisi:",o);const{data:n,error:d}=yield m.from("writer_profiles").select("id").eq("user_id",null==E?void 0:E.id).single();let c=null;if(n){console.log("🔄 Mevcut profil güncelleniyor...",n.id);const{error:e}=yield m.from("writer_profiles").update(o).eq("user_id",null==E?void 0:E.id);c=e}else{console.log("➕ Yeni profil ekleniyor...");const{error:e}=yield m.from("writer_profiles").insert(o);c=e}if(c)return console.error("❌ Writer profiles güncelleme hatası:",c),void re("Profil güncellenemedi: "+c.message);if(e){const{error:l}=yield m.from("posts").update({author_name:e}).eq("author_id",null==E?void 0:E.id);l?console.error("❌ Yazılar güncelleme hatası:",l):console.log("✅ Tüm yazılardaki yazar adı güncellendi")}console.log("✅ Profil başarıyla güncellendi! (Hem user_metadata hem writer_profiles)"),te("Profil başarıyla güncellendi! Ana sayfada da görünecek."),setTimeout(()=>{window.location.reload()},2e3)}catch(l){console.error("❌ Catch hatası:",l),re("Profil güncellenemedi: "+l.message)}finally{ae(!1)}}),className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center space-x-6",children:[u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden bg-gray-200",children:ce?u.jsx("img",{src:ce,alt:"Profil",className:"w-full h-full object-cover"}):u.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:u.jsx(_,{className:"h-8 w-8"})})}),ue&&u.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center",children:u.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"})})]}),u.jsxs("div",{children:[u.jsxs("label",{className:"cursor-pointer bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors",children:["Resim Seç",u.jsx("input",{type:"file",accept:"image/*",onChange:e=>d(null,null,function*(){const l=e.target.files[0];if(l)if(l.size>5242880)alert("Dosya boyutu 5MB'dan büyük olamaz.");else if(l.type.startsWith("image/")){pe(!0);try{const e=new FileReader;e.onload=e=>{me(e.target.result),de(l=>n(o({},l),{profileImage:e.target.result}))},e.readAsDataURL(l)}catch(a){console.error("❌ Resim yükleme hatası:",a),alert("Resim yüklenirken hata oluştu.")}finally{pe(!1)}}else alert("Sadece resim dosyaları yüklenebilir.")}),className:"hidden",disabled:ue})]}),u.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"JPG, PNG veya WebP (Max 5MB)"})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"İsim *"}),u.jsx("input",{type:"text",value:ne.firstName,onChange:e=>de(l=>n(o({},l),{firstName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Adınız",required:!0})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Soyisim *"}),u.jsx("input",{type:"text",value:ne.lastName,onChange:e=>de(l=>n(o({},l),{lastName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Soyadınız",required:!0})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Unvan *"}),u.jsx("input",{type:"text",value:ne.title,onChange:e=>de(l=>n(o({},l),{title:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Örn: Editör & Seyahat Yazarı",required:!0})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hakkımda"}),u.jsx("textarea",{value:ne.bio,onChange:e=>de(l=>n(o({},l),{bio:e.target.value})),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Kendiniz hakkında kısa bir açıklama yazın..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lokasyon"}),u.jsx("input",{type:"text",value:ne.location,onChange:e=>de(l=>n(o({},l),{location:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Örn: İstanbul, Türkiye"})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Instagram"}),u.jsx("input",{type:"text",value:(null==(Y=ne.socialMedia)?void 0:Y.instagram)||"",onChange:e=>de(l=>n(o({},l),{socialMedia:n(o({},l.socialMedia||{}),{instagram:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"@kullanici_adi"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Twitter"}),u.jsx("input",{type:"text",value:(null==(P=ne.socialMedia)?void 0:P.twitter)||"",onChange:e=>de(l=>n(o({},l),{socialMedia:n(o({},l.socialMedia||{}),{twitter:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"@kullanici_adi"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Blog/Website"}),u.jsx("input",{type:"url",value:(null==(C=ne.socialMedia)?void 0:C.blog)||"",onChange:e=>de(l=>n(o({},l),{socialMedia:n(o({},l.socialMedia||{}),{blog:e.target.value})})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"https://website.com"})]})]}),u.jsx("div",{className:"flex justify-end",children:u.jsxs("button",{type:"submit",disabled:le,className:"bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 disabled:opacity-50 transition-colors flex items-center space-x-2",children:[u.jsx(k,{className:"h-4 w-4"}),u.jsx("span",{children:le?"Kaydediliyor...":"Profili Kaydet"})]})})]})]})]})}),!1]})]}):null};export{z as default};
