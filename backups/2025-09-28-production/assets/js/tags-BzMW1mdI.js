var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,n=(e,t)=>{for(var r in t||(t={}))l.call(t,r)&&s(e,r,t[r]);if(a)for(var r of a(t))o.call(t,r)&&s(e,r,t[r]);return e},u=(e,t,r)=>new Promise((a,l)=>{var o=e=>{try{n(r.next(e))}catch(t){l(t)}},s=e=>{try{n(r.throw(e))}catch(t){l(t)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,s);n((r=r.apply(e,t)).next())});import{s as i}from"./index-D5E9gJaD.js";const g={getAll:()=>u(null,null,function*(){const{data:e,error:t}=yield i.from("tags").select("*").order("name");return{data:e,error:t}}),getFeatured:()=>u(null,null,function*(){const{data:e,error:t}=yield i.from("tags").select("*").eq("is_featured",!0).order("usage_count",{ascending:!1});return{data:e,error:t}}),getBySlug:e=>u(null,null,function*(){const{data:t,error:r}=yield i.from("tags").select("*").eq("slug",e).single();return{data:t,error:r}}),getTagInfo:e=>u(null,null,function*(){const{data:t,error:r}=yield i.from("tags").select("*").eq("slug",e).single();return{data:t,error:r}}),getMostUsed:(e=10)=>u(null,null,function*(){const{data:t,error:r}=yield i.from("tags").select("*").gt("usage_count",0).order("usage_count",{ascending:!1}).limit(e);return{data:t,error:r}}),create:e=>u(null,null,function*(){const a=_(e.name),{data:l,error:o}=yield i.from("tags").insert((s=n({},e),u={slug:a},t(s,r(u)))).select();var s,u;return l&&0!==l.length?{data:l[0],error:o}:{data:null,error:{message:"Etiket oluşturulamadı"}}}),update:(e,t)=>u(null,null,function*(){const r=n({},t);t.name&&(r.slug=_(t.name));const{data:a,error:l}=yield i.from("tags").update(r).eq("id",e).select();return a&&0!==a.length?{data:a[0],error:l}:{data:null,error:{message:"Güncellenecek etiket bulunamadı"}}}),delete:e=>u(null,null,function*(){const{error:t}=yield i.from("tags").delete().eq("id",e);return{error:t}})},d={getPostTags:e=>u(null,null,function*(){const{data:t,error:r}=yield i.from("post_tags").select("\n        tags (\n          id,\n          name,\n          slug,\n          color,\n          is_featured\n        )\n      ").eq("post_id",e);return{data:(null==t?void 0:t.map(e=>e.tags))||[],error:r}}),addTagToPost:(e,t)=>u(null,null,function*(){const{data:r,error:a}=yield i.rpc("add_tag_to_post",{post_id:e,tag_slug:t});return{data:r,error:a}}),removeTagFromPost:(e,t)=>u(null,null,function*(){const{data:r,error:a}=yield i.rpc("remove_tag_from_post",{post_id:e,tag_slug:t});return{data:r,error:a}}),updatePostTags:(e,t)=>u(null,null,function*(){const{error:r}=yield i.from("post_tags").delete().eq("post_id",e);if(r)return{error:r};if(0===t.length)return{data:!0,error:null};const{data:a,error:l}=yield i.from("tags").select("id, slug").in("slug",t);if(l)return{error:l};const o=a.map(t=>({post_id:e,tag_id:t.id})),{data:s,error:n}=yield i.from("post_tags").insert(o);return{data:s,error:n}}),getPostsByTag:(e,...t)=>u(null,[e,...t],function*(e,t={}){const{limit:r=12,offset:a=0}=t;try{const{data:t,error:l}=yield i.rpc("get_posts_by_tag",{tag_slug:e,limit_count:r});if(!l&&t)return{data:t,error:null};const{data:o,error:s}=yield i.from("posts_with_tags").select("*").eq("status","published").order("published_at",{ascending:!1}).range(a,a+r-1);if(s)return{data:[],error:s};return{data:(null==o?void 0:o.filter(t=>{var r;return null==(r=t.tag_objects)?void 0:r.some(t=>t.slug===e)}))||[],error:null}}catch(l){return console.error("getPostsByTag error:",l),{data:[],error:l}}})},c={getWithTags:(...e)=>u(null,[...e],function*(e={}){const{limit:t=10,offset:r=0,status:a="published",categoryId:l=null,tagSlug:o=null}=e;let s=i.from("posts_with_tags").select("*").order("published_at",{ascending:!1});a&&(s=s.eq("status",a)),l&&(s=s.eq("category_id",l)),t&&(s=s.range(r,r+t-1));const{data:n,error:u}=yield s;if(o&&n){return{data:n.filter(e=>{var t;return null==(t=e.tag_objects)?void 0:t.some(e=>e.slug===o)}),error:u}}return{data:n,error:u}}),getMainPagePosts:(e=20)=>u(null,null,function*(){try{console.log("📌 Ana sayfa yazıları getiriliyor...");const{data:t,error:r}=yield i.rpc("get_posts_by_tag",{tag_slug:"main",limit_count:e});if(r){console.error("❌ Ana sayfa RPC error:",r);const{data:t,error:a}=yield i.from("posts_with_tags").select("*").eq("status","published").order("published_at",{ascending:!1}).limit(e);if(a)return console.error("❌ Fallback view error:",a),{data:[],error:a};const l=(null==t?void 0:t.filter(e=>{var t;return null==(t=e.tag_objects)?void 0:t.some(e=>"main"===e.slug||"Ana Sayfa"===e.name)}))||[];return console.log("✅ Fallback view sonucu:",l.length,"yazı"),{data:l,error:null}}const a=(null==t?void 0:t.map(e=>({id:e.post_id,title:e.title,slug:e.slug,excerpt:e.excerpt,featured_image_url:e.featured_image_url,category_name:e.category_name,category_slug:e.category_slug,category_color:"#3B82F6",published_at:e.published_at,status:"published",views:0,likes:0,author_name:"Editör"})))||[];return console.log("✅ Ana sayfa yazıları:",a.length,"adet"),{data:a,error:null}}catch(t){return console.error("Ana sayfa yazıları getirilemedi:",t),{data:[],error:t}}}),getMostReadPosts:(e=6)=>u(null,null,function*(){console.log("📊 En çok okunan yazılar getiriliyor... (Ana sayfa)");const{data:t,error:r}=yield i.rpc("get_posts_by_tag",{tag_slug:"encokokunan",limit_count:e});if(r||!t||0===t.length)return console.log("⚠️ En çok okunan RPC başarısız, fallback deneniyor..."),yield c.getWithTags({tagSlug:"encokokunan",limit:e,status:"published"});return{data:t.map(e=>({id:e.post_id,title:e.title,slug:e.slug,excerpt:e.excerpt,featured_image_url:e.featured_image_url,category_name:e.category_name,category_slug:e.category_slug,published_at:e.published_at,status:"published"})),error:null}}),getRecommendedPosts:(e=6)=>u(null,null,function*(){const{data:t,error:r}=yield i.rpc("get_posts_by_tag",{tag_slug:"bunlariokudunuzmu",limit_count:e});if(r||!t||0===t.length)return yield c.getWithTags({tagSlug:"bunlariokudunuzmu",limit:e,status:"published"});return{data:t.map(e=>({id:e.post_id,title:e.title,slug:e.slug,excerpt:e.excerpt,featured_image_url:e.featured_image_url,category_name:e.category_name,category_slug:e.category_slug,published_at:e.published_at,status:"published"})),error:null}}),getEditorCommentPosts:(e=3)=>u(null,null,function*(){console.log("✏️ Editör önerileri getiriliyor...");const{data:t,error:r}=yield i.rpc("get_posts_by_tag",{tag_slug:"oneri",limit_count:e});if(r||!t||0===t.length)return yield c.getWithTags({tagSlug:"oneri",limit:e,status:"published"});return{data:t.map(e=>({id:e.post_id,title:e.title,slug:e.slug,excerpt:e.excerpt,featured_image_url:e.featured_image_url,category_name:e.category_name,category_slug:e.category_slug,published_at:e.published_at,created_at:e.created_at,author_name:e.author_name||"Editör",status:"published"})),error:null}}),getLifestylePosts:(e=12)=>u(null,null,function*(){console.log("🌿 Lifestyle yazıları getiriliyor...");const{data:t,error:r}=yield i.rpc("get_posts_by_tag",{tag_slug:"lifestyle",limit_count:e});if(r||!t||0===t.length)return console.log("⚠️ RPC başarısız, fallback kullanılıyor..."),yield c.getWithTags({tagSlug:"lifestyle",limit:e,status:"published"});return{data:t.map(e=>({id:e.post_id,title:e.title,slug:e.slug,excerpt:e.excerpt,featured_image_url:e.featured_image_url,category_name:e.category_name,category_slug:e.category_slug,published_at:e.published_at,created_at:e.created_at,author_name:e.author_name||"Editör",views:e.views||0,likes:e.likes||0,status:"published"})),error:null}}),getPostsByTag:(e,t=12)=>u(null,null,function*(){try{console.log("🏷️ Etiketli yazılar getiriliyor:",e,"limit:",t);const{data:r,error:a}=yield i.rpc("get_posts_by_tag",{tag_slug:e,limit_count:t});if(!a&&r&&r.length>0)return console.log(`✅ RPC ile ${r.length} yazı bulundu`),{data:r,error:null};console.log("🔄 RPC başarısız, posts_with_tags view deneniyor...");const{data:l,error:o}=yield i.from("posts_with_tags").select("*").eq("status","published").contains("tag_slugs",[e]).order("published_at",{ascending:!1}).limit(t);return o?(console.error("getPostsByTag error:",o),{data:[],error:o}):(console.log(`✅ ${(null==l?void 0:l.length)||0} yazı bulundu`),{data:l||[],error:null})}catch(r){return console.error("getPostsByTag error:",r),{data:[],error:r}}}),getLatestPosts:(e=1e3)=>u(null,null,function*(){try{const{data:t,error:r}=yield i.from("posts_with_tags").select("*").eq("status","published").order("published_at",{ascending:!1}).limit(e);return r?(console.error("getLatestPosts error:",r),{data:[],error:r}):{data:t,error:null}}catch(t){return console.error("getLatestPosts error:",t),{data:[],error:t}}}),getPostsByTagHighLimit:(e,t=50)=>u(null,null,function*(){try{console.log("🏷️ Etiketli yazılar getiriliyor (yüksek limit):",e);const{data:r,error:a}=yield i.rpc("get_posts_by_tag",{tag_slug:e,limit_count:t});if(!a&&r&&r.length>0)return console.log(`✅ RPC ile ${r.length} yazı bulundu`),{data:r,error:null};console.log("🔄 RPC başarısız, posts_with_tags view deneniyor...");const{data:l,error:o}=yield i.from("posts_with_tags").select("*").eq("status","published").contains("tag_slugs",[e]).order("published_at",{ascending:!1}).limit(t);return o?(console.error("getPostsByTagHighLimit error:",o),{data:[],error:o}):(console.log(`✅ ${(null==l?void 0:l.length)||0} yazı bulundu`),{data:l||[],error:null})}catch(r){return console.error("getPostsByTag error:",r),{data:[],error:r}}}),getTagInfo:e=>u(null,null,function*(){try{console.log("🏷️ Etiket bilgisi getiriliyor:",e);const{data:t,error:r}=yield i.from("tags").select("*").eq("slug",e).single();return r?(console.error("getTagInfo error:",r),{data:null,error:r}):(console.log("✅ Etiket bilgisi:",t),{data:t,error:null})}catch(t){return console.error("getTagInfo error:",t),{data:null,error:t}}})},_=e=>e.toLowerCase().replace(/[ğ]/g,"g").replace(/[ü]/g,"u").replace(/[ş]/g,"s").replace(/[ı]/g,"i").replace(/[ö]/g,"o").replace(/[ç]/g,"c").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-");export{c as a,g as b,d as p};
