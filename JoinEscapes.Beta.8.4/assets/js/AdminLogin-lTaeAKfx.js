const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/index-BbGdIXXl.js","assets/js/react-vendor-9pH4USaU.js","assets/js/supabase-Cd1B4uHG.js","assets/js/utils-Dxy8Veww.js","assets/js/ui-vendor-BW9IHOa4.js","assets/index--5X5uWKa.css"])))=>i.map(i=>d[i]);
var e=(e,a,r)=>new Promise((s,t)=>{var i=e=>{try{n(r.next(e))}catch(a){t(a)}},l=e=>{try{n(r.throw(e))}catch(a){t(a)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,l);n((r=r.apply(e,a)).next())});import{_ as a}from"./supabase-Cd1B4uHG.js";import{u as r,j as s}from"./index-BbGdIXXl.js";import{u as t,b as i,r as l}from"./react-vendor-9pH4USaU.js";import{r as n,i as o}from"./inputValidator-i9iGeD-F.js";import{h as d,i as m,E as c,j as u,k as x,L as p,X as b}from"./ui-vendor-BW9IHOa4.js";import"./utils-Dxy8Veww.js";const g=()=>{const{isAuthenticated:g,loading:h,signIn:y,signUp:f,user:j}=r(),v=t(),N=i(),[w,k]=l.useState(!1),[z,E]=l.useState(""),[S,C]=l.useState(""),[_,A]=l.useState(""),[G,Y]=l.useState(!1),[K,B]=l.useState(""),[P,D]=l.useState(""),[V,q]=l.useState(!1),[F,L]=l.useState("yazar"),[R,H]=l.useState(!1),[O,T]=l.useState(""),[$,I]=l.useState(!1),[U,J]=l.useState(""),[Z,M]=l.useState(!1),[Q,W]=l.useState("");l.useEffect(()=>{var e;(null==(e=N.state)?void 0:e.message)&&(W(N.state.message),E(N.state.email||""))},[N.state]),l.useEffect(()=>{if(g&&!h&&j&&j.id&&"test@test.com"!==j.email)return console.log("🚫 AdminLogin: Yetkisiz erişim denemesi:",j.email),alert("Bu sayfaya giriş yapamazsınız! Sadece admin bu sayfayı kullanabilir."),void v("/",{replace:!0})},[g,h,j,v]),l.useEffect(()=>{var e,a;if(g&&!h&&j&&j.id){const r=(null==(e=j.user_metadata)?void 0:e.user_role)||j.role;if(("editor"===r||"yazar"===r||"supervisor"===r)&&"test@test.com"!==j.email&&!(null==(a=j.user_metadata)?void 0:a.editor_approved))return void v("/adminlogin",{state:{message:"Hesabınız henüz onaylanmadı. Admin onayı bekliyor.",email:j.email}});if("test@test.com"!==j.email)return console.log("🚫 Admin: Yetkisiz erişim denemesi:",j.email,"Rol:",r),alert("Bu panele sadece test@test.com erişebilir!"),void v("/",{replace:!0});console.log("✅ Admin: test@test.com girişi, admin paneline yönlendiriliyor"),v("/admin")}},[g,h,j,v]);return h?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-white flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):g?null:R?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-white flex items-center justify-center p-4",children:s.jsxs("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-6 text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(d,{className:"h-8 w-8 text-green-600"})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"E-posta Doğrulama"}),s.jsxs("p",{className:"text-gray-600 mb-4",children:[s.jsx("strong",{children:O})," adresine doğrulama linki gönderildi."]}),s.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Lütfen e-posta kutunuzu kontrol edin ve linke tıklayarak hesabınızı aktifleştirin."}),("editor"===F||"yazar"===F||"supervisor"===F)&&s.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-blue-700",children:[s.jsx("strong",{children:"Not:"})," E-posta doğrulama sonrası admin onayı bekleyeceksiniz."]})}),s.jsx("button",{onClick:()=>{H(!1),T(""),k(!1)},className:"w-full bg-primary-600 text-white py-2 px-4 rounded-lg hover:bg-primary-700 transition-colors",children:"Giriş Yap"})]})}):s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-white flex items-center justify-center p-4",children:[s.jsxs("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-6",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(m,{className:"h-8 w-8 text-primary-600"})}),s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:w?"Yönetici Kaydı":"Yönetici Girişi"}),s.jsx("p",{className:"text-gray-600",children:w?"JoinEscapes yönetim ekibine katılın":"Yönetim paneline giriş yapın"})]}),K&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:K}),P&&s.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg text-green-700 text-sm",children:P}),Q&&s.jsx("div",{className:"mb-4 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(d,{className:"h-5 w-5 text-orange-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Onay Bekliyor"}),s.jsx("p",{className:"text-sm text-orange-700",children:Q}),s.jsx("p",{className:"text-xs text-orange-600 mt-2",children:"Admin tarafından onaylandıktan sonra giriş yapabileceksiniz."})]})]})}),s.jsxs("form",{onSubmit:a=>e(null,null,function*(){a.preventDefault(),B(""),D(""),q(!0);try{const e=n.checkAuthEndpoint(w?"signup":"signin");if(!e.allowed)return void B(e.message);const a=o.validateEmail(z);if(!a.isValid)return void B("E-posta hatası: "+a.errors.join(", "));const r=o.validatePassword(S);if(!r.isValid)return void B("Şifre hatası: "+r.errors.join(", "));if(w){if(S!==_)return void B("Şifreler eşleşmiyor");console.log("🔍 Kayıt işlemi:",{email:z,selectedRole:F});const{data:e,error:a}=yield f(z,S,F);a?B("Kayıt işlemi başarısız: "+a.message):(null==e?void 0:e.needsEmailConfirmation)?(H(!0),T(z),E(""),C(""),A(""),D("editor"===F||"yazar"===F||"supervisor"===F?"Kayıt başarılı! E-posta doğrulama sonrası admin onayı bekleyeceksiniz.":"Kayıt başarılı! E-posta adresinize gönderilen doğrulama linkine tıklayarak hesabınızı aktifleştirin.")):D("Kayıt başarılı! Giriş yapabilirsiniz.")}else{if("test@test.com"!==z)return void B("Bu sayfaya giriş yapamazsınız! Sadece admin bu sayfayı kullanabilir.");const{data:e,error:a}=yield y(z,S);a?B("Giriş başarısız: "+a.message):D("Giriş başarılı! Yönlendiriliyorsunuz...")}}catch(e){B("Bir hata oluştu: "+e.message)}finally{q(!1)}}),className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-posta"}),s.jsx("input",{type:"email",value:z,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"E-posta adresinizi girin",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Şifre"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:G?"text":"password",value:S,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Şifrenizi girin",required:!0}),s.jsx("button",{type:"button",onClick:()=>Y(!G),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:G?s.jsx(c,{className:"h-4 w-4"}):s.jsx(u,{className:"h-4 w-4"})})]})]}),w&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Şifre (Tekrar)"}),s.jsx("input",{type:"password",value:_,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Şifrenizi tekrar girin",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rol"}),s.jsxs("select",{value:F,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[s.jsx("option",{value:"yazar",children:"Yazar"}),s.jsx("option",{value:"supervisor",children:"Süpervizör"})]})]})]}),s.jsx("button",{type:"submit",disabled:V,className:"w-full bg-primary-600 text-white py-2 px-4 rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:V?s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):w?s.jsxs(s.Fragment,{children:[s.jsx(x,{className:"h-4 w-4 mr-2"})," Hesap Oluştur"]}):s.jsxs(s.Fragment,{children:[s.jsx(p,{className:"h-4 w-4 mr-2"})," Giriş Yap"]})}),s.jsxs("div",{className:"text-center space-y-2",children:[!w&&s.jsx("div",{children:s.jsx("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),I(!0)},className:"text-sm text-gray-600 hover:text-primary-600 cursor-pointer",children:"Şifremi unuttum"})}),s.jsx("div",{children:s.jsx("button",{type:"button",onClick:()=>k(!w),className:"text-sm text-primary-600 hover:text-primary-700",children:w?"Zaten hesabın var mı? Giriş yap":"Hesabın yok mu? Kayıt ol"})})]})]})]}),$&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 w-full max-w-md mx-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Şifremi Unuttum"}),s.jsx("button",{onClick:()=>{I(!1),J(""),B(""),D("")},className:"text-gray-400 hover:text-gray-600",children:s.jsx(b,{className:"h-5 w-5"})})]}),s.jsx("p",{className:"text-gray-600 mb-4",children:"E-posta adresinizi girin, size şifre sıfırlama linki gönderelim."}),s.jsxs("form",{onSubmit:r=>e(null,null,function*(){r.preventDefault(),B(""),D(""),M(!0);try{const r=o.validateEmail(U);if(!r.isValid)return void B("E-posta hatası: "+r.errors.join(", "));const{supabase:s}=yield a(()=>e(null,null,function*(){const{supabase:e}=yield import("./index-BbGdIXXl.js").then(e=>e.b);return{supabase:e}}),__vite__mapDeps([0,1,2,3,4,5])),{error:t}=yield s.auth.resetPasswordForEmail(U,{redirectTo:"localhost"===window.location.hostname?`${window.location.protocol}//${window.location.host}/adminlogin?reset=true`:`${window.location.origin}/adminlogin?reset=true`});t?B("Şifre sıfırlama hatası: "+t.message):(D("Şifre sıfırlama linki e-posta adresinize gönderildi."),I(!1),J(""))}catch(s){B("Bir hata oluştu: "+s.message)}finally{M(!1)}}),children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-posta Adresi"}),s.jsx("input",{type:"email",value:U,onChange:e=>J(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"E-posta adresinizi girin",required:!0})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("button",{type:"button",onClick:()=>{I(!1),J(""),B(""),D("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",disabled:Z,children:"İptal"}),s.jsx("button",{type:"submit",className:"flex-1 bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 disabled:opacity-50",disabled:Z,children:Z?"Gönderiliyor...":"Gönder"})]})]})]})})]})};export{g as default};
